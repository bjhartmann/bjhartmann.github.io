---
layout: single
title: "Research"
permalink: /research/
author_profile: false
custom_tab_title: "Research | Björn Hartmann"
redirect_from:
  - /publications/
---

{% assign pubs = site.publications | sort: "date" | reverse %}
{% assign category_order = "workingpaper,workinprogress,otherwriting" | split: "," %}

<style>
  .pub-section { margin: 2rem 0 1rem; }
  .pub-h2 { font-size: 1.35rem; font-weight: 800; margin: 0 0 .75rem; }

  .pub-item { padding: 0.6rem 0; border-bottom: 1px solid #eee; }
  .pub-top { display: flex; justify-content: space-between; align-items: baseline; gap: 1rem; }

  /* Titles look like plain text */
  .pub-title { font-weight: 600; color: inherit; text-decoration: none; }
  .pub-title:hover { text-decoration: none; }

  /* Toggle button reset/accessibility */
  .pub-toggle { background: none; border: 0; padding: 0; font: inherit; color: inherit; cursor: pointer; text-align: left; }
  .pub-toggle:focus-visible { outline: 2px solid #94a3b8; outline-offset: 2px; }

  /* Reset: never add an after-element to plain titles */
  .pub-title::after { content: none !important; }

  /* Caret only on actual toggle buttons that control a panel */
  button.pub-toggle[aria-controls]::after {
    content: "▸";
    margin-left: .4rem;
    transition: transform .15s ease;
    line-height: 1;
  }
  button.pub-toggle[aria-expanded="true"][aria-controls]::after {
    transform: rotate(90deg);
  }

  .pub-links a { text-decoration: none; }
  .pub-links a:hover { text-decoration: underline; }

  .pub-authors { color: #555; margin-top: 0.2rem; }
  .pub-venue   { color: #666; margin-top: 0.2rem; font-style: bold; }

  /* Only styling (no visibility rules) */
  .pub-abstract { margin-top: 0.6rem; color: #333; }

  @media (max-width: 640px) { .pub-top { flex-direction: column; align-items: flex-start; } }
</style>

{% for cat in category_order %}
  {%- comment -%}
    Build the list of items for this category without using where_exp (unsupported on GH Pages Jekyll 3.10).
    We iterate over all publications, pick matches manually, and capture the HTML into `items`.
  {%- endcomment -%}
  {% assign items = "" %}

  {% for post in pubs %}
    {% assign matches_cat = false %}
    {% if post.category == cat %}
      {% assign matches_cat = true %}
    {% elsif post.categories and post.categories contains cat %}
      {% assign matches_cat = true %}
    {% endif %}

    {% if matches_cat %}
      {%- comment -%} Robust unique id & abstract presence {%- endcomment -%}
      {% assign pid_source = post.id | default: post.slug | default: post.title %}
      {% assign pid = pid_source | replace: '/', '-' | replace: '.', '-' | replace: ' ', '-' %}
      {% assign abs_id = "abs-" | append: pid %}
      {% assign has_abstract = post.abstract | to_s | strip != "" %}
      {% assign show_toggle = (cat == "workingpaper") and has_abstract %}

      {% capture items %}{{ items }}
        <div class="pub-item">
          <div class="pub-top">
            {% if show_toggle %}
              <!-- Working Paper: title toggles abstract -->
              <button class="pub-title pub-toggle" aria-expanded="false" aria-controls="{{ abs_id }}" type="button">
                {{ post.title }}
              </button>
            {% else %}
              <!-- Non-toggle title (WiP or no abstract) -->
              <span class="pub-title">{{ post.title }}</span>
            {% endif %}

            <span class="pub-links">
              {% if post.paperurl %}
                [<a href="{{ post.paperurl }}" target="_blank" rel="noopener">{{ post.paperlabel | default: "paper" }}</a>]
              {% endif %}
              {% if post.slidesurl %}
                [<a href="{{ post.slidesurl }}" target="_blank" rel="noopener">{{ post.slideslabel | default: "slides" }}</a>]
              {% endif %}
              {% if post.codeurl %}
                [<a href="{{ post.codeurl }}" target="_blank" rel="noopener">{{ post.codelabel | default: "code" }}</a>]
              {% endif %}
              {% if post.doi %}
                [<a href="https://doi.org/{{ post.doi | escape }}" target="_blank" rel="noopener">doi</a>]
              {% endif %}
            </span>
          </div>

          {% if post.authors %}
            <div class="pub-authors">{{ post.authors }}</div>
          {% endif %}
          {% if post.venue %}
            <div class="pub-venue">{{ post.venue }}</div>
          {% endif %}

          {% if show_toggle %}
            <div id="{{ abs_id }}" class="pub-abstract" aria-hidden="true" hidden>
              {{ post.abstract | markdownify }}
            </div>
          {% endif %}
        </div>
      {% endcapture %}
    {% endif %}
  {% endfor %}

  {% if items != "" %}
    <section class="pub-section" id="{{ cat }}">
<h2 class="pub-h2">
  {% case cat %}
    {% when "workingpaper" %}Working Papers
    {% when "workinprogress" %}Work in Progress
    {% when "otherwriting" %}Other Writings
    {% else %}{{ cat | capitalize }}
  {% endcase %}
</h2>
      {{ items }}
    </section>
  {% endif %}
{% endfor %}

<script>
document.addEventListener('click', function (e) {
  const btn = e.target.closest('.pub-toggle');
  if (!btn) return;

  // Prefer aria-controls target if present…
  let panel = null;
  const controls = btn.getAttribute('aria-controls');
  if (controls) {
    panel = document.getElementById(controls);
  }
  // …fallback: find the abstract within the same pub-item
  if (!panel) {
    const container = btn.closest('.pub-item');
    panel = container ? container.querySelector('.pub-abstract') : null;
  }
  if (!panel) return;

  const expanded = btn.getAttribute('aria-expanded') === 'true';
  btn.setAttribute('aria-expanded', String(!expanded));
  panel.setAttribute('aria-hidden', String(expanded));
  panel.hidden = expanded; // <-- key: use the native hidden attribute
});
</script>
